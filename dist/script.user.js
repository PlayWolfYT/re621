// ==UserScript==
// @name          RE621 - e621 Enhancement Suite
// @namespace     re621.bitwolfy.com
// @version       2.0.0
// @author        bitWolfy
// @description   Subscription manager, mass downloader, thumbnail enhancer, and more for e621
// @license       GPL-3.0
// @homepageURL   https://github.com/bitWolfy/re621
// @supportURL    https://github.com/bitWolfy/re621/issues
// @icon          https://cdn.jsdelivr.net/gh/bitwolfy/re621@master/assets/icon64.png
// @icon64        https://cdn.jsdelivr.net/gh/bitwolfy/re621@master/assets/icon64.png
// @updateURL     https://github.com/bitWolfy/re621/releases/latest/download/script.meta.js
// @downloadURL   https://github.com/bitWolfy/re621/releases/latest/download/script.user.js
// @match         https://e621.net/*
// @match         https://e926.net/*
// @require       https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js
// @require       https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js
// @require       https://cdn.jsdelivr.net/npm/winbox@0.2.1/dist/winbox.bundle.min.js
// @require       https://cdn.jsdelivr.net/npm/jsframe.js/lib/jsframe.min.js
// @grant         GM_info
// @grant         GM_setValue
// @grant         GM_getValue
// @grant         GM_deleteValue
// @grant         GM_addValueChangeListener
// @grant         GM_removeValueChangeListener
// @grant         GM_setClipboard
// @connect       api.github.com
// @connect       static1.e621.net
// @connect       *
// @run-at        document-start
// ==/UserScript==

(()=>{"use strict";class Script{}Script.version=GM_info.script.version,Script.handler={name:GM_info.scriptHandler,version:GM_info.version},Script.url={website:"https://re621.bitwolfy.com/",repo:"https://github.com/re621/re621/",issues:"https://github.com/re621/re621/issues",thread:"https://e621.net/forum_topics/25872",latest:"https://api.github.com/repos/re621/re621/releases/latest"};class UtilID{static make(e=8,t=!0){if(!t)return n(e);let o;do{o=n(e)}while(UtilID.uniqueIDs.has(o));return UtilID.uniqueIDs.add(o),o;function n(e){let t="";const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=o.length;for(let i=0;i<e;i++)t+=o.charAt(Math.floor(Math.random()*n));return t}}static has(e){return UtilID.uniqueIDs.has(e)}static remove(e){return!!UtilID.has(e)&&(UtilID.uniqueIDs.delete(e),!0)}static rand(){return(Util.Time.now()+"").slice(-5)}}UtilID.uniqueIDs=new Set;var e,t,o=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};!function(e){e[e.Byte=1]="Byte",e[e.Kilobyte=1024]="Kilobyte",e[e.Megabyte=1048576]="Megabyte",e[e.Gigabyte=1073741824]="Gigabyte",e[e.Terabyte=1099511627776]="Terabyte",e[e.Petabyte=0x4000000000000]="Petabyte"}(e||(e={})),function(e){e.format=function(e,t=2){if("string"==typeof e&&(e=parseInt(e)),!e||0===e)return"0 B";const o=t<0?0:t,n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(o))+["B","KB","MB","GB","TB","PB"][n]},e.unformat=function(e){if(Util.Math.isNumeric(e))return parseInt(e);e=e.toUpperCase();for(const[t,o]of[/\dB$/,/\dKB$/,/\dMB$/,/\dGB$/,/\dTB$/,/\dPB$/].entries())if(o.test(e))return parseInt(e)*Math.pow(1024,t);return 0}}(e||(e={}));class RISSizeLimit{constructor(e,t=0,o=0){this.size=e,this.width=t,this.height=o}test(e){return e.file.size<=this.size&&(0==this.width||e.img.width<=this.width)&&(0==this.height||e.img.height<=this.height)}toString(){return`${this.width}x${this.height} (${this.size})`}}RISSizeLimit.Google=new RISSizeLimit(20*e.Megabyte,8e3,6e3),RISSizeLimit.SauceNAO=new RISSizeLimit(15*e.Megabyte),RISSizeLimit.Derpibooru=new RISSizeLimit(20*e.Megabyte),RISSizeLimit.Kheina=new RISSizeLimit(8*e.Megabyte,7500,7500),RISSizeLimit.Yandex=new RISSizeLimit(100*e.Megabyte,15e4,15e4),function(e){e[e.SECOND=1e3]="SECOND",e[e.MINUTE=6e4]="MINUTE",e[e.HOUR=36e5]="HOUR",e[e.DAY=864e5]="DAY",e[e.WEEK=6048e5]="WEEK",e[e.MONTH=2592e6]="MONTH",e[e.YEAR=31536e6]="YEAR"}(t||(t={})),function(e){e.now=function(){return(new Date).getTime()},e.ago=function(e){switch(typeof e){case"string":e=+new Date(e);break;case"object":e=e.getTime()}const t=[[60,"seconds",1],[120,"1 minute ago","1 minute from now"],[3600,"minutes",60],[7200,"1 hour ago","1 hour from now"],[86400,"hours",3600],[172800,"Yesterday","Tomorrow"],[604800,"days",86400],[1209600,"Last week","Next week"],[2419200,"weeks",604800],[4838400,"Last month","Next month"],[29030400,"months",2419200],[58060800,"Last year","Next year"],[290304e4,"years",29030400],[580608e4,"Last century","Next century"],[580608e5,"centuries",290304e4]];let o=(+new Date-e)/1e3,n="ago",i=1;if(o>=0&&o<2)return"Just now";o<0&&(o=Math.abs(o),n="from now",i=2);let r,a=0;for(;r=t[a++];)if(o<r[0])return"string"==typeof r[2]?r[i]:Math.floor(o/r[2])+" "+r[1]+" "+n;return e+""},e.format=function(e=new Date){"number"!=typeof e&&"string"!=typeof e||(e=new Date(e));const t={year:""+e.getFullYear(),month:""+(e.getMonth()+1),day:""+e.getDate(),hours:""+e.getHours(),minutes:""+e.getMinutes(),seconds:""+e.getSeconds()};for(const e in t)t[e].length<2&&(t[e]="0"+t[e]);return t.year+"-"+t.month+"-"+t.day+" "+t.hours+":"+t.minutes+":"+t.seconds},e.formatPeriod=function(t){return t<e.MINUTE?(t/e.SECOND).toFixed(1)+" seconds":t<e.HOUR?(t/e.MINUTE).toFixed(1)+" minutes":t<e.DAY?(t/e.HOUR).toFixed(1)+" hours":t<e.WEEK?(t/e.DAY).toFixed(1)+" days":t<e.MONTH?(t/e.WEEK).toFixed(1)+" weeks":t<e.YEAR?(t/e.MONTH).toFixed(1)+" months":(t/e.YEAR).toFixed(1)+" years"},e.getDatetimeShort=function(){function e(e){return(e<10?"0":"")+e}const t=new Date;return(t.getFullYear()+"").substring(2)+e(t.getMonth()+1)+e(t.getDate())+"-"+e(t.getHours())+e(t.getMinutes())},e.formatPlaytime=function(e){const t=(e=Math.ceil(e))%60;return Math.floor(e/60)+":"+(t<10?"0":"")+t}}(t||(t={}));var n=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class Util{static downloadAsJSON(e,t){const o=$("<a>").attr({download:t+".json",href:"data:application/json,"+encodeURIComponent(JSON.stringify(e,null,4))}).appendTo("body").on("click",(()=>{o.remove()}));o[0].click()}static sleep(e){return n(this,void 0,void 0,(function*(){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}))}static chunkArray(e,t,o="balance"){Array.isArray(e)||(e=Array.from(e));const n=[];switch(o){case"chunk":for(let o=0;o<e.length;o+=t)n.push(e.slice(o,o+t));break;case"split":n[0]=e.slice(0,t),n[1]=e.slice(t);break;default:for(let o=Math.ceil(e.length/t);o>0;o--)n.push(e.splice(0,Math.ceil(e.length/o)))}return n}static getArrayIndexes(e,t){const o=[];let n=0;for(;n<e.length;n++)e[n]===t&&o.push(n);return o}static quickParseMarkdown(e){return void 0===e?"":e.replace(/\*\*(.*?)\*\*/gm,"<strong>$1</strong>").replace(/\_(.*?\S)\_/gm,"<em>$1</em>").replace(/\[(.+)\]\((.*)\)/gm,'<a href="$2">$1</a>').replace(/^[-]+(.*)?/gim,"<ul><li>$1</li></ul>").replace(/\<\/ul\>\r\n\<ul\>/gm,"").replace(/\n(?!<)/gm,"<br />")}static stripDText(e,t=!0){return t&&(e=e.replace(/\[quote\][\s\S]*\[\/quote\]/g,"").replace(/\[code\][\s\S]*\[\/code\]/g,"").replace(/\\[section[\s\S]*\[\/section\]/g,"")),e=e.replace(/\[b\]([\s\S]*)\[\/b\]/g,"<b>$1</b>").replace(/\[i\]([\s\S]*)\[\/i\]/g,"<i>$1</i>").replace(/\[u\]([\s\S]*)\[\/u\]/g,"<u>$1</u>").replace(/\[o\]([\s\S]*)\[\/o\]/g,"<o>$1</o>").replace(/\[s\]([\s\S]*)\[\/s\]/g,"<s>$1</s>").replace(/\[sup\]([\s\S]*)\[\/sup\]/g,"<sup>$1</sup>").replace(/\[sub\]([\s\S]*)\[\/sub\]/g,"<sub>$1</sub>").replace(/\[spoiler\]([\s\S]*)\[\/spoiler\]/g,"<span>$1</span>").replace(/\[color\]([\s\S]*)\[\/color\]/g,"<span>$1</span>")}static formatK(e){return Math.abs(e)>999?(Math.sign(e)*(Math.abs(e)/1e3)).toFixed(1)+"k":Math.sign(e)*Math.abs(e)+""}static formatRatio(e,t){const o=function e(t,o){if(t===o)return t;if(0===t)return o;if(0===o)return t;if(1&~t)return 1&o?e(t>>1,o):e(t>>1,o>>1)<<1;return 1&~o?e(t,o>>1):t>o?e(t-o>>1,o):e(o-t>>1,t)}(e,t);return[e/o,t/o]}static getTagString(e){return e.val().toString().trim().toLowerCase().replace(/\r?\n|\r/g," ").replace(/(?:\s){2,}/g," ")}static getTags(e){if(Array.isArray(e)){const t=[];for(const o of e)t.push(...Util.getTags(o));return t}return("string"==typeof e?e:Util.getTagString(e)).split(" ").filter((e=>null!=e&&""!=e))}static getKeyRegex(e){const t=[];for(const o of Object.keys(e))t.push(o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"));return new RegExp(t.join("|"),"gi")}static versionCompare(e,t,o){const n=o&&o.lexicographical,i=o&&o.zeroExtend;if("string"!=typeof e||"string"!=typeof t)return NaN;let r=e.split("."),a=t.split(".");function s(e){return(n?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}if(!r.every(s)||!a.every(s))return NaN;if(i){for(;r.length<a.length;)r.push("0");for(;a.length<r.length;)a.push("0")}n||(r=r.map(Number),a=a.map(Number));for(let e=0;e<r.length;++e){if(a.length==e)return 1;if(r[e]!=a[e])return r[e]>a[e]?1:-1}return r.length!=a.length?-1:0}static prettyPrintArray(e,t="and"){return 1==e.length?e[0]:2==e.length?e[0]+" "+t+" "+e[1]:e.slice(0,-1).join(", ")+", "+t+" "+e.slice(-1)}}Util.DOM=class UtilDOM{static addSettingsButton(e,t="menu.extra"){void 0===e.name&&(e.name="T"),void 0===e.href&&(e.href=""),void 0===e.title&&(e.title=""),void 0===e.tabClass&&(e.tabClass=""),void 0===e.linkClass&&(e.linkClass=""),void 0===e.attr&&(e.attr={});const o=$("<li>").appendTo(t),n=$("<a>").html(e.name).attr({title:e.title,id:e.id}).appendTo(o);return void 0!==e.onClick&&n.on("click",(()=>{e.onClick(n)})),e.href&&n.attr("href",e.href),e.tabClass&&o.addClass(e.tabClass),e.linkClass&&n.addClass(e.linkClass),e.attr&&n.attr(e.attr),n}static addStyle(e){return $("<style>").attr({id:Util.ID.make(),type:"text/css"}).html(e).appendTo("head")}static getPlaceholderImage(){return"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}static getKoFiImage(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALsAAAAkBAMAAAAjjlbPAAAAHlBMVEVDS1dDS1dDS1f+/v5DS1fi4uOLjpO8vcD/X1z/p6boDZakAAAAA3RSTlMCtVgF8JOLAAACCElEQVRIx+3XMW7bMBQGYLUnCIoeoENv8OuZ8NbAP8kDUBTRWbRyANLxAbKwc1AguW0H2nJSq6kBV0sRDhpI4BP19PhINs3Hz1yofWqapllMJ2+a5sNyOm+b5uuCPL8sGRvypllS57d3/gLe+KmF+O95jVOTuCiP1eGLxvFySftoffw7Lw5S+xKgLuadj8nnN/j1T3x/BFo61FmksMPFvJDuzeCU8lyKQ8sN6ixSJrin7XRmIBmSsuio0ZE0TnmSFooaPXcIW3hukWnRz/BSSinlES31ke9HoaNuNx2FJATOKcILyUGckHSC6DxyggzACKeYPOI5vz7ngdUrnkNrxK6YMumyFdIIjVUc2hqcTUs3Cod2NjgHfjjyYYf4ghcOHUWLdx0ppJBWkbqlXVV+EI+9eDfHP5VSfgCtcYcfmjJTfsVvKu/zxK9+5/2deN/NZU4p5QGQKR3P+aGj6LoqHE0NDrWiXk3BoVV/yPunUmrqH16ewh4x9anbqO1p9gb3LpIpJCGJPo24d13lrew9XZ/yHL8uDwCAwBfLSgPRQE48E4SkrX1bSBwgx7xPUNxiLnMAPAOAmipBLQpjJMdRSEYaMtae47MORzKShjTjaWS+KLTnK9KGpK4raXbiuxkeyFfW+4mfq8YmXrtb3XnvfQj7/L7X/i/8wofAhY+wCx/AF74+LHv5+QUPP47PCU3CGwAAAABJRU5ErkJggg=="}static getLoadingImage(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAyVBMVEUAAAC9vsDCw8W9v8G9vsD29/fr7O29vsDm5+jx8fK/wML29vf///+9vsHR0tPm5+jt7u7w8PHr7Ozc3d7n6OnExcfGx8nJyszMzM7V1tjZ2tvf4OG9vsDHyMrp6uvIycu9v8HAwcTPz9HCw8W9vsC9vsDBwsTj5OXj5OXW19i9vsDm5+jw8PHy8vL09fW9vsDFxsjJyszAwsS9vsDU1dbLzM7Y2drb3N3c3d7e3+DHyMrBwsTh4uPR0tPDxcfa293R0tTV1ti9vsAll6RJAAAAQnRSTlMA7+t/MAZHQDYjHxABv6xSQjEgFgzi2M7Emop0cGVLD/ryt7Cfj3dmYWBgWjgsGd/Cv7SvopSSg4B6eHZrQjkyKx1dd0xhAAAA9klEQVR4AYWPeXOCMBBHFxIgCQKC3KCo1Wprtfd98/0/VBPb6TC0Wd+/783+ZqELrQkRoIMujFbiaLTwpESC029reB7919d7u6SgYaE8aUCivW84oEUY0lPQc408pxBqHxCIHGiw4Lxtl5h35ALFglouAAaZTj00OJ7NrvDANI/Q4PlQMDbNFA3ekiQRaHGRpmM0eMqyyxgLRlme4ydu8/n8Az3h+37xiRWv/k1RRlhxUtyVD8yCXwaDflHeP1Zr5sIey3WtfvFeVS+rTWAzFobhNhrFf4omWK03wcS2h8OzLd/1TyhiNvkJQu5amocjznm0i6HDF1RMG1aMA/PYAAAAAElFTkSuQmCC"}},Util.Events=class UtilEvents{static on(e,t){$(document).on(e,((e,o)=>{t(e,o)}))}static one(e,t){$(document).on(e,((o,n)=>{t(o,n),this.off(e)}))}static off(e){$(document).off(e)}static trigger(e,t){$(document).trigger(e,t)}static triggerVueEvent(e,t,o){const n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),o&&e.data(o,"true"),e[0].dispatchEvent(n)}},Util.ID=UtilID,Util.Math=class UtilMath{static clamp(e,t,o){return Math.min(Math.max(e,t),o)}static between(e,t,o){return t<=e&&o>=e}static isNumeric(e){return!isNaN(Number(e))}static round(e,t=2){return 0==t?parseInt(e.toFixed(t)):parseFloat(e.toFixed(t))}},Util.Network=class UtilNetwork{static isOnline(){return o(this,void 0,void 0,(function*(){return navigator.onLine?new Promise((e=>{XM.Connect.xmlHttpRequest({method:"HEAD",url:"e621.net"==window.location.host?"https://e621.net/":"https://e926.net/",onerror:()=>{e(!1)},onload:()=>{e(!0)}})})):Promise.resolve(!1)}))}},Util.Time=t,Util.Size=e,Util.LS=window.localStorage,Util.SS=window.sessionStorage;var i=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class XMChrome{static execBackgroundRequest(e,t,o,n){return i(this,void 0,void 0,(function*(){return new Promise((i=>{chrome.runtime.sendMessage(XMChrome.formatRequestData(e,t,o,n),(e=>{XMChrome.requests=XMChrome.requests.filter((t=>t!==e.eventID)),i(e.data)}))}))}))}static execBackgroundConnection(e){return i(this,void 0,void 0,(function*(){return Promise.resolve(chrome.runtime.connect({name:e}))}))}static execInjectorRequest(e,t,o,n){return i(this,void 0,void 0,(function*(){return new Promise((i=>{const r=XMChrome.formatRequestData(e,t,o,n),a=function(e){const t=e.detail;document.removeEventListener("re621.chrome.message.response-"+t.eventID,a),XMChrome.requests=XMChrome.requests.filter((e=>e!==t.eventID)),i(t.data)};document.addEventListener("re621.chrome.message.response-"+r.eventID,a),document.dispatchEvent(new CustomEvent("re621.chrome.message",{detail:r}))}))}))}static formatRequestData(e,t,o,n){return{component:e,module:t,method:o,eventID:function(){let e;do{e=Util.ID.make(8,!1)}while(XMChrome.requests.includes(e));return XMChrome.requests.push(e),e}(),args:void 0===n?[]:n}}static getResourceURL(e){return chrome.extension.getURL(e)}static download(e,t,o){return chrome.downloads.download({url:e,filename:t,saveAs:o})}}XMChrome.requests=[];var r=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class XMConnect{static xmlHttpRequest(e){Debug.connectLog(e.url);const t=XMConnect.validateXHRDetails(e);"undefined"!=typeof GM&&"function"==typeof GM.xmlHttpRequest?GM.xmlHttpRequest(t):"function"==typeof GM_xmlhttpRequest?GM_xmlhttpRequest(t):XM.Chrome.execBackgroundConnection("XHR").then((o=>{o.postMessage(t),o.onMessage.addListener((t=>r(this,void 0,void 0,(function*(){"onload"===t.event&&("blob"===e.responseType?t.response=yield fetch(t.response).then((e=>e.blob())):"arraybuffer"===e.responseType&&(t.response=yield fetch(t.response).then((e=>e.arrayBuffer()))),URL.revokeObjectURL(t.responseURL)),e[t.event](t)}))))}))}static xmlHttpPromise(e){const t=XMConnect.validateXHRDetails(e);return new Promise(((o,n)=>{const i={onabort:t.onabort,onerror:t.onerror,onload:t.onload,onloadstart:t.onloadstart,onprogress:t.onprogress,onreadystatechange:t.onreadystatechange,ontimeout:t.ontimeout};e.onabort=e=>{i.onabort(e),n(e)},e.onerror=e=>{i.onerror(e),n(e)},e.onload=e=>{i.onload(e),o(e)},e.onloadstart=e=>{i.onloadstart(e)},e.onprogress=e=>{i.onprogress(e)},e.onreadystatechange=e=>{i.onreadystatechange(e)},e.ontimeout=e=>{i.ontimeout(e),n(e)},XMConnect.xmlHttpRequest(t)}))}static validateXHRDetails(e){return void 0===e.headers&&(e.headers={}),void 0===e.headers["User-Agent"]&&(e.headers["User-Agent"]=window.re621.useragent,e.headers["X-User-Agent"]=window.re621.useragent),void 0===e.onabort&&(e.onabort=()=>{}),void 0===e.onerror&&(e.onerror=()=>{}),void 0===e.onload&&(e.onload=()=>{}),void 0===e.onloadstart&&(e.onloadstart=()=>{}),void 0===e.onprogress&&(e.onprogress=()=>{}),void 0===e.onreadystatechange&&(e.onreadystatechange=()=>{}),void 0===e.ontimeout&&(e.ontimeout=()=>{}),e}static getResourceText(e){return r(this,void 0,void 0,(function*(){return"function"==typeof GM_getResourceText?Promise.resolve(GM_getResourceText(e)):"undefined"!=typeof GM?XMConnect.getResourceTextGM(e):XMConnect.xmlHttpPromise({url:window.resources[e].startsWith("http")?window.resources[e]:XM.Chrome.getResourceURL(window.resources[e]),method:"GET"}).then((e=>Promise.resolve(e.responseText)),(e=>Promise.reject(e.status+" "+e.statusText)))}))}static getResourceTextGM(e){return r(this,void 0,void 0,(function*(){const t="function"==typeof GM.getResourceUrl?yield GM.getResourceUrl(e):GM_getResourceURL(e);return t.startsWith("data:")?Promise.resolve(atob(t.replace(/^data:(.*);base64,/g,""))):t.startsWith("blob:")?new Promise(((e,o)=>r(this,void 0,void 0,(function*(){const n=yield fetch(t,{credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Agent":window.re621.useragent,"X-User-Agent":window.re621.useragent},method:"GET",mode:"cors"});n.ok?e(yield n.text()):o()})))):Promise.reject()}))}static getResourceJSON(e){return r(this,void 0,void 0,(function*(){return XMConnect.getResourceText(e).then((e=>Promise.resolve(JSON.parse(e))),(e=>Promise.reject(e)))}))}static download(e,t){let o;"string"==typeof e&&(e={url:e,name:t}),void 0===e.headers&&(e.headers={"User-Agent":window.re621.useragent,"X-User-Agent":window.re621.useragent}),void 0===e.onerror&&(e.onerror=()=>{}),void 0===e.onload&&(e.onload=()=>{}),void 0===e.onprogress&&(e.onprogress=()=>{}),void 0===e.ontimeout&&(e.ontimeout=()=>{}),XMConnect.xmlHttpRequest({url:e.url,method:"GET",headers:e.headers,responseType:"blob",onerror:t=>{e.onerror(t)},ontimeout:t=>{e.ontimeout(t)},onprogress:t=>{o&&clearTimeout(o),o=window.setTimeout((()=>{e.onprogress(t)}),500)},onload:t=>{e.onload(t);const o=$("<a>").attr({href:URL.createObjectURL(t.response),download:e.name}).html("download").on("click",(()=>{o.remove()}));o[0].click()}})}static browserDownload(e,t,o){Debug.getState("vivaldi")&&XM.Connect.download(e,t);("string"==typeof e?{url:e,name:t,saveAs:o}:e).onerror=o=>{if("not_whitelisted"==o.error)XM.Connect.download(e,t);else{if(!e.onerror)throw"Error: unable to download file"+(o.error?` [${o.error}]`:"");e.onerror(o)}},"function"==typeof GM_download?GM_download(e):XM.Chrome.download(e,t,o)}}var a=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class XM{static info(){return"undefined"==typeof GM?{script:null,scriptMetaStr:null,scriptHandler:Script.handler.name,version:"1.0"}:GM.info}static isUserscript(){return"script"==window.re621.type}}XM.Storage=class XMStorage{static setValue(e,t){return a(this,void 0,void 0,(function*(){return GM_setValue(e,t)}))}static getValue(e,t){return a(this,void 0,void 0,(function*(){return GM_getValue(e,t)}))}static deleteValue(e){return a(this,void 0,void 0,(function*(){return GM_deleteValue(e)}))}static addListener(e,t){return a(this,void 0,void 0,(function*(){return GM_addValueChangeListener(e,t)}))}static removeListener(e){return a(this,void 0,void 0,(function*(){return GM_removeValueChangeListener(e)}))}},XM.Connect=XMConnect,XM.Util=class XMUtil{static openInTab(e,t=!0){"undefined"==typeof GM?XM.Chrome.execBackgroundRequest("XM","Util","openInTab",[e,t]):GM.openInTab(e,{active:t})}static setClipboard(e,t){"undefined"==typeof GM?XM.Chrome.execBackgroundRequest("XM","Util","setClipboard",[e]):GM.setClipboard(e,t)}},XM.Chrome=XMChrome,XM.Window="undefined"==typeof unsafeWindow?window:unsafeWindow;var s=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class Debug{static init(){return s(this,void 0,void 0,(function*(){return Debug.enabled=yield XM.Storage.getValue("re621.debug.enabled",!1),Debug.connect=yield XM.Storage.getValue("re621.debug.connect",!1),Debug.perform=yield XM.Storage.getValue("re621.debug.perform",!1),Debug.vivaldi=yield XM.Storage.getValue("re621.debug.vivaldi",!1),Promise.resolve(!0)}))}static getState(e){return Debug[e]}static setState(e,t){Debug[e]=t,t?XM.Storage.setValue("re621.debug."+e,t):XM.Storage.deleteValue("re621.debug."+e)}static log(...e){Debug.enabled&&console.log(...e)}static table(e){Debug.enabled&&console.table(e)}static connectLog(...e){Debug.connect&&console.log("CONNECT",...e)}static perfStart(e){Debug.perform&&console.time(e)}static perfEnd(e){Debug.perform&&console.timeEnd(e)}}var l=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};const d=[{name:"posts",path:"posts.json",node:"posts"},{name:"post",path:"posts/%ID%.json",node:"post"},{name:"post_votes",path:"posts/%ID%/votes.json"},{name:"tags",path:"tags.json"},{name:"tag",path:"tags/%ID%.json"},{name:"tag_aliases",path:"tag_aliases.json"},{name:"tag_implications",path:"tag_implications.json"},{name:"notes",path:"notes.json"},{name:"favorites",path:"favorites.json",node:"posts"},{name:"favorite",path:"favorites/%ID%.json"},{name:"pools",path:"pools.json"},{name:"pool",path:"pools/%ID%.json"},{name:"sets",path:"post_sets.json"},{name:"set",path:"post_sets/%ID%.json"},{name:"set_add_post",path:"post_sets/%ID%/add_posts.json"},{name:"set_remove_post",path:"post_sets/%ID%/remove_posts.json"},{name:"users",path:"users.json"},{name:"user",path:"users/%ID%.json"},{name:"blips",path:"blips.json"},{name:"wiki_pages",path:"wiki_pages.json"},{name:"comments",path:"comments.json"},{name:"comment",path:"comments/%ID%.json"},{name:"forum_posts",path:"forum_posts.json"},{name:"forum_post",path:"forum_posts/%ID%.json"},{name:"forum_topics",path:"forum_topics.json"},{name:"forum_topic",path:"forum_topics/%ID%.json"},{name:"dtext_preview",path:"dtext_preview"},{name:"iqdb_queries",path:"iqdb_queries.json"}];class APIEndpoint{constructor(e,t){this.queue=e,this.path=t.path,this.name=t.name,this.node=t.node}id(e){return this.param=e+"",this}get(e,t){return l(this,void 0,void 0,(function*(){return this.queue.createRequest(this.getParsedPath(),this.formatParam(e),"GET",{},this.name,this.node,t).then((e=>{const t=this.formatData(e[0],e[2]);return Promise.resolve(t)}),(e=>Promise.reject(e[0])))}))}first(e,t){return l(this,void 0,void 0,(function*(){return this.get(e,t).then((e=>e.length>0?Promise.resolve(e[0]):Promise.resolve(null)))}))}post(e,t,o){return l(this,void 0,void 0,(function*(){return this.queue.createRequest(this.getParsedPath(),{},"POST",this.formatParam(e,o),this.name,this.node,t).then((e=>Promise.resolve(e)),(e=>Promise.reject(e)))}))}delete(e,t){return l(this,void 0,void 0,(function*(){return this.queue.createRequest(this.getParsedPath(),{},"DELETE",this.formatParam(e),this.name,this.node,t).then((e=>Promise.resolve(e)),(e=>Promise.reject(e)))}))}put(e,t){return l(this,void 0,void 0,(function*(){return this.queue.createRequest(this.getParsedPath(),{},"PUT",this.formatParam(e),this.name,this.node,t).then((e=>Promise.resolve(e)),(e=>Promise.reject(e)))}))}patch(e,t){return l(this,void 0,void 0,(function*(){return this.queue.createRequest(this.getParsedPath(),{},"PATCH",this.formatParam(e),this.name,this.node,t).then((e=>Promise.resolve(e)),(e=>Promise.reject(e)))}))}getParsedPath(){if(this.param){const e=this.path.replace(/%ID%/g,this.param);return this.param=void 0,e}return this.path}formatParam(e,t=!1){if(null==e)return{};const o={};for(const[i,r]of Object.entries(e))if(null!=r)if(Array.isArray(r)){for(const[e,o]of r.entries())r[e]=n(o,t);o[i]=r.join("+")}else if("object"==typeof r)for(const[e,a]of Object.entries(r))if(Array.isArray(a)){for(const[e,o]of a.entries())a[e]=n(o,t);o[`${i}[${e}]`]=a.join("+")}else o[`${i}[${e}]`]=n(a,t);else o[i]=n(r,t);return o;function n(e,t){return t?encodeURIComponent(e+""):encodeURIComponent(decodeURIComponent(e+""))}}formatData(e,t){return void 0!==t&&(e=e[t]),Array.isArray(e)?e:[e]}}class E621{constructor(){this.emitter=$({}),this.processing=!1,this.requestIndex=0,this.endpoints={},this.authToken=$("head meta[name=csrf-token]").attr("content"),this.queue=[],d.forEach((e=>{this.endpoints[e.name]=new APIEndpoint(this,e)}))}static getEndpoint(e){return void 0===this.instance&&(this.instance=new E621),this.instance.endpoints[e]}createRequest(e,t,o,n,i,r,a){return l(this,void 0,void 0,(function*(){void 0===a?a=E621.requestRateLimit:a<500&&(a=500);const s={credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Agent":window.re621.useragent,"X-User-Agent":window.re621.useragent},method:o,mode:"cors"};"GET"!==o&&(this.authToken=$("meta[name=csrf-token]").attr("content"),n.authenticity_token=encodeURIComponent(this.authToken),s.body=c.stringify(n)),t._client=window.re621.useragent;const l=new Request(location.origin+"/"+e+"?"+c.stringify(t),s),d=this.requestIndex++,u=new Promise(((e,t)=>{this.emitter.one("api.re621.result-"+d,((o,n,i,r,a)=>{null===n&&(n=[]),void 0===n[r]||["posts","post"].includes(r)||(n=[]),void 0===n.error?e([n,i,a]):t([n,i,a])}))}));return this.add({request:l,index:d,delay:a,endpoint:i,node:r}),u}))}add(e){return l(this,void 0,void 0,(function*(){if(this.queue.push(e),!this.processing){for(this.processing=!0;this.queue.length>0;){const e=this.queue.shift();Debug.connectLog(e.request.url),yield new Promise((t=>l(this,void 0,void 0,(function*(){fetch(e.request).then((o=>l(this,void 0,void 0,(function*(){if(o.ok){let t=yield o.text();t||(t="[]"),this.emitter.trigger("api.re621.result-"+e.index,[JSON.parse(t),o.status,e.endpoint,e.node])}else this.emitter.trigger("api.re621.result-"+e.index,[{error:o.status+" "+o.statusText},o.status,e.endpoint,e.node]);t()}))),(o=>{this.emitter.trigger("api.re621.result-"+e.index,[{error:o&&o[0]?o[1]+" "+o[0].error:"unknown error"},o&&o[0]?o[1]:500,e.endpoint,e.node]),t()}))})))),yield Util.sleep(e.delay)}this.processing=!1}}))}}var c;E621.requestRateLimit=1e3,E621.Posts=E621.getEndpoint("posts"),E621.Post=E621.getEndpoint("post"),E621.PostVotes=E621.getEndpoint("post_votes"),E621.Tags=E621.getEndpoint("tags"),E621.Tag=E621.getEndpoint("tag"),E621.TagAliases=E621.getEndpoint("tag_aliases"),E621.TagImplications=E621.getEndpoint("tag_implications"),E621.Notes=E621.getEndpoint("notes"),E621.Favorites=E621.getEndpoint("favorites"),E621.Favorite=E621.getEndpoint("favorite"),E621.Pools=E621.getEndpoint("pools"),E621.Pool=E621.getEndpoint("pool"),E621.Sets=E621.getEndpoint("sets"),E621.Set=E621.getEndpoint("set"),E621.SetAddPost=E621.getEndpoint("set_add_post"),E621.SetRemovePost=E621.getEndpoint("set_remove_post"),E621.Users=E621.getEndpoint("users"),E621.User=E621.getEndpoint("user"),E621.Blips=E621.getEndpoint("blips"),E621.Wiki=E621.getEndpoint("wiki_pages"),E621.Comments=E621.getEndpoint("comments"),E621.Comment=E621.getEndpoint("comment"),E621.ForumPosts=E621.getEndpoint("forum_posts"),E621.ForumPost=E621.getEndpoint("forum_post"),E621.ForumTopics=E621.getEndpoint("forum_topics"),E621.ForumTopic=E621.getEndpoint("forum_topic"),E621.DTextPreview=E621.getEndpoint("dtext_preview"),E621.IQDBQueries=E621.getEndpoint("iqdb_queries"),function(e){e.stringify=function(e){const t=[];for(const[o,n]of Object.entries(e))t.push(o+"="+n);return t.join("&")}}(c||(c={}));var u,m=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class User{static init(){const e=$("body").data();function t(e){const t=$(`meta[name="${e}"]`);return 0==t.length?null:t.attr("content")}User.loggedIn=0==e.userIsAnonymous,User.username=e.userName||"Anonymous",User.userID=e.userId||-1,User.level=e.userLevel||0,User.levelString=e.userLevelString||"Anonymous",User.isMember=1==e.userIsMemeber,User.isPrivileged=1==e.userIsPrivileged,User.isContributor=1==e.userIsContributor,User.isJanitor=1==e.userIsJanitor,User.isModerator=1==e.userIsModerator,User.isAdmin=1==e.userIsAdmin,User.isFormerStaff=1==e.userIsFormerStaff,User.isVoter=1==e.userIsVoter,User.isVerified=1==e.userIsVerified,User.isApprover=1==e.userIsApprover,User.isBlocked=1==e.userIsBlocked,User.isBanned=1==e.userIsBanned,User.canApprovePosts=1==e.userCanApprovePosts,User.canUploadFree=1==e.userCanUploadFree,User.postsPerPage=e.userPerPage||75,User.commentThreshold=parseInt(t("user-comment-threshold"))||3,User.blacklistedTags=t("blacklisted-tags"),User.blacklistUsers="true"==t("blacklist-users"),User.enableJSNavigation="true"==t("enable-js-navigation"),User.enableAutoComplete="true"==t("enable-auto-complete"),User.styleUsernames="true"==t("style-usernames"),User.defaultImageSize=u.get(t("default-image-size"))}static getCurrentSettings(){return m(this,void 0,void 0,(function*(){return E621.User.id(User.userID).first()}))}static setSettings(e){return m(this,void 0,void 0,(function*(){yield E621.User.id(this.userID).post({user:e,_method:"patch"})}))}}!function(e){e.Sample="large",e.FitHeight="fitv",e.FitWidth="fit",e.Original="original"}(u||(u={})),function(e){e.get=function(t){switch(t){case"large":return e.Sample;case"fitv":return e.FitHeight;case"fit":return e.FitWidth;case"original":return e.Original}return e.Sample}}(u||(u={}));class Page{constructor(){this.url=new URL(window.location.toString())}static matches(e){e instanceof RegExp&&(e=[e]);const t=this.getInstance().url.pathname.replace(/[\/?]$/g,"");let o=!1;return e.forEach((function(e){o=o||e.test(t)})),o}static getURL(){return this.getInstance().url}static getQueryParameter(e){return this.getInstance().url.searchParams.get(e)}static hasQueryParameter(e){return this.getInstance().url.searchParams.has(e)}static setQueryParameter(e,t){this.getInstance().url.searchParams.set(e,t),this.refreshCurrentUrl()}static removeQueryParameter(e){Array.isArray(e)||(e=[e]);for(const t of e)this.getInstance().url.searchParams.delete(t);this.refreshCurrentUrl()}static refreshCurrentUrl(){const e=this.getInstance().url,t=0===e.searchParams.toString().length?"":"?";history.replaceState({},"",e.origin+e.pathname+t+e.searchParams.toString()+e.hash)}static getSiteName(){return this.getInstance().url.hostname.replace(/\.net/g,"")}static getPageID(){return this.getInstance().url.pathname.split("/")[2]}static getInstance(){return void 0===this.instance&&(this.instance=new Page),this.instance}static getPageType(){for(const[e,t]of Object.entries(p))if(Page.matches(t))return e;return null}}const p={title:/^(\/)?$/,search:/^\/posts\/?$/,post:/^\/posts\/\d+\/?(show_seq)?$/,upload:/\/uploads\/new\/?/,forum:/^\/forum_topics\/?.*/,forumPost:/^\/forum_topics\/\d+.*/,pool:/^\/pools\/.+/,set:/^\/post_sets\/.+/,popular:/^\/explore\/posts\/popular.?/,favorites:/^\/favorites\/?.*/,wiki:/^\/wiki_pages\/[0-9]+/,wikiNA:/^\/wiki_pages\/show_or_new.*/,artist:/^\/artists\/[0-9]+/,comments:/^\/comments\??.*/,settings:/^\/users\/\.+\/edit$/,changes:/^\/post_versions.*/,tickets:/^\/tickets.*/,profile:/^\/users\/.+$/,iqdb:/^\/iqdb_queries.*/,deleted_posts:/^\/deleted_posts.*/,blips:/^\/blips.*/,help:/^\/help.*/,postConfirmDelete:/^\/moderator\/post\/posts\/.+\/confirm_delete.*/};class DOMTools{static addStyle(e){return $("<style>").attr({id:Util.ID.make(),type:"text/css"}).html(e).appendTo("head")}static patchHeader(){const e=$("nav#nav"),t=$("menu.main");$("#nav").find("menu").length<2?$("<menu>").addClass("subnav").appendTo(e):$("#nav menu").last().addClass("subnav"),$("<menu>").addClass("logo").html(`<a href="/">${Page.getSiteName()}</a>`).prependTo(e),t.find("#nav-e").remove(),$("<menu>").addClass("extra").insertAfter(t)}static setupDialogContainer(){$("<div>").attr("id","modal-container").prependTo("body")}static addSettingsButton(e,t="menu.extra"){void 0===e.name&&(e.name="T"),void 0===e.href&&(e.href=""),void 0===e.title&&(e.title=""),void 0===e.tabClass&&(e.tabClass=""),void 0===e.linkClass&&(e.linkClass=""),void 0===e.attr&&(e.attr={});const o=$("<li>").appendTo(t),n=$("<a>").html(e.name).attr({title:e.title,id:e.id}).appendTo(o);return void 0!==e.onClick&&n.on("click",(()=>{e.onClick(n)})),e.href&&n.attr("href",e.href),e.tabClass&&o.addClass(e.tabClass),e.linkClass&&n.addClass(e.linkClass),e.attr&&n.attr(e.attr),n}}var f=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class PageObserver{static init(){this.observer&&this.targets||(this.targets=new Map,this.observer=new MutationObserver((()=>{for(const[e,t]of Array.from(this.targets.entries()))document.querySelector(e)&&(this.targets.delete(e),t(!0))})),this.observer.observe(document,{childList:!0,subtree:!0}),$((()=>{this.observer.disconnect(),this.pageLoaded=!0;for(const e of Array.from(this.targets.values()))e(!1);this.targets=new Map})))}static watch(e){return $(e).length>0?Promise.resolve(!0):this.pageLoaded?Promise.resolve(!1):new Promise((t=>{this.targets.set(e,t)}))}static awaitFocus(){return f(this,void 0,void 0,(function*(){return new Promise((e=>{document.hasFocus()||"visible"==document.visibilityState?e(!0):$(window).one("focus",(()=>e(!0)))}))}))}}PageObserver.pageLoaded=!1;class Modal{constructor(e){this.triggers=[],this.isDisabled=!1,this.id=Util.ID.make(),e=this.validateConfig(e),this.triggersMulti=e.triggerMulti,this.isDisabled=e.disabled,this.$modal=$("<div>").attr("title",e.title).append(e.content).dialog({autoOpen:e.autoOpen,appendTo:"#modal-container",resizable:!1,width:"auto",minWidth:e.minWidth,minHeight:e.minHeight,position:{my:e.position.my,at:e.position.at,of:"#modal-container",within:"#modal-container"},classes:{"ui-dialog":"bg-foreground border-section color-text","ui-dialog-titlebar":"color-text","ui-dialog-titlebar-close":"border-foreground"}});this.$modal.closest(".ui-dialog").draggable("option","containment","#modal-container"),e.structure&&this.$modal.one("dialogopen.lazyload",(()=>{this.$modal.html(""),this.$modal.append(e.structure.render())})),this.registerTrigger(e.triggers)}enable(){this.isDisabled=!1}disable(){this.isDisabled=!0}get isOpen(){return this.$modal.dialog("isOpen")}set isOpen(e){this.$modal.dialog(e?"open":"close")}open(){this.isOpen=!0}close(){this.isOpen=!1}toggle(){this.isOpen=!this.isOpen}validateConfig(e){const t={};return t.title=void 0===e.title?"Dialog":e.title,t.autoOpen=void 0!==e.autoOpen&&e.autoOpen,t.triggers=void 0===e.triggers?[]:e.triggers,t.triggerMulti=void 0!==e.triggerMulti&&e.triggerMulti,t.content=void 0===e.content?$(""):e.content,t.structure=void 0===e.structure?null:e.structure,t.minWidth=void 0===e.minWidth?150:e.minWidth,t.minHeight=void 0===e.minHeight?150:e.minHeight,t.disabled=void 0!==e.disabled&&e.disabled,void 0===e.position?t.position={my:"center",at:"center"}:t.position={my:e.position.my?e.position.my:"center",at:e.position.at?e.position.at:"center"},t}addContent(e){this.$modal.append(e)}setContent(e){this.$modal.html(""),this.$modal.append(e)}registerTrigger(e){if(e)if(Array.isArray(e))for(const t of e)this.registerTrigger(t);else void 0===e.event&&(e.event="click"),0==this.triggers.length&&(this.activeTrigger=e.element),this.triggers.push(e),e.element.on(e.event+".re621.dialog-"+this.id,(e=>{if(this.isDisabled)return;e.preventDefault();const t=$(e.currentTarget);return this.triggersMulti&&!this.activeTrigger.is(t)&&this.isOpen&&this.toggle(),this.activeTrigger=t,this.toggle(),!1}))}clearTriggers(){for(const e of this.triggers)e.element.off(e.event+".re621.dialog-"+this.id);this.triggers=[]}getElement(){return this.$modal}destroy(){this.$modal.dialog("destroy"),this.$modal.remove()}getActiveTrigger(){return this.activeTrigger}}Modal.isReady=!1;var h=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class ErrorHandler{static log(e,t,o){return h(this,void 0,void 0,(function*(){const e=$("<div>").html(["<p>RE621 had encountered an error during script execution.</p>",`<p>Please, report this message, including the error log below, through the <a href="${Script.url.issues}">issue tracker</a>, or in the <a href="${Script.url.thread}">forum thread</a>.</p>`].join("\n")),n=$("<textarea>").val([`RE621 v.${Script.version} for ${Script.handler.name} v.${Script.handler.version}`,window.navigator.userAgent,t,o&&o.stack?o.stack:o].join("\n"));console.error(["[ErrorHandler]",e.text().trim(),(n.val()+"").trim()].join("\n")),Modal.isReady||(yield PageObserver.watch("modal-container"));new Modal({title:"Error",autoOpen:!0}).getElement().addClass("error-handler").append(e).append(n)}))}}const g=["1","2","3","4","5","6","7","8","9","0","-","=",".",",","/",";","'","[","]","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","escape","ctrl","alt","shift","return","up","down","left","right"],b={enter:"return",control:"ctrl",arrow:"","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=","<":",",">":".","?":"//",":":";",'"':"'","{":"[","}":"]"},v=Util.getKeyRegex(b);class KeybindManager{static enable(){KeybindManager.enabled=!0}static disable(){KeybindManager.enabled=!1}static block(){KeybindManager.blocked=!0}static register(e){if(!KeybindManager.blocked)if(Array.isArray(e))for(const t of e)this.register(t);else{this.refreshListener(e.keys,e.element,e.selector);for(const t of e.keys)0!=t.length&&(this.executors.get(t)[e.bindMeta]=e)}}static unregister(e){Array.isArray(e)||(e=[e]);for(const t of this.executors.values())for(const o of Object.keys(t))e.includes(o)&&delete t[o]}static record(e){KeybindManager.listening=!0;let t=[];$(document).on("keydown.re621.record",(e=>{const o=e.key.toLowerCase().replace(v,(e=>b[e]));-1!=g.indexOf(o)&&t.push(o)})),$(document).on("keyup.re621.record",(()=>{if(0!==t.length)return $(document).off(".re621.record"),e(t),void(KeybindManager.listening=!1);t=[]}))}static count(e){return this.executors.has(e)?Object.keys(this.executors.get(e)).length:0}static refreshListener(e,t,o){for(const n of e)if(0!=n.length){if(!this.listeners.has(n)){let e=!1;this.listeners.set(n,(t=>{if(KeybindManager.listening)return;const o=this.executors.get(n);Debug.log(`[${n}]: triggered ${Object.entries(o).length} executors`);for(const[n,i]of Object.entries(o))i.enabled&&(i.holdable&&(e=!1),i.fnct(t,n))}));const i=t?$(t):$(document);o||(o=null);let r=null;i.on("keydown.re621.hotkey-"+n,o,n,(t=>{if(!e&&!r){if(e=!0,!KeybindManager.enabled||KeybindManager.listening)return!1;Debug.log(`[${n}]: caught`),this.listeners.get(n)(t),clearTimeout(r),r=setTimeout((()=>{clearTimeout(r),r=null}),50)}})),i.on("keyup.re621.hotkey-"+n,o,n,(()=>{e=!1})),$(window).on("blur",(()=>{e=!1}))}this.executors.has(n)||this.executors.set(n,{})}}}KeybindManager.listeners=new Map,KeybindManager.executors=new Map,KeybindManager.enabled=!0,KeybindManager.blocked=!1,KeybindManager.listening=!1;class Form{constructor(e,t,o){e.name||(e.name=Util.ID.make()),e.columns||(e.columns=1),e.width||(e.width=e.columns),this.element=$("<form>").addClass("form-section"+(e.wrapper?" "+e.wrapper:"")).attr({id:e.name,columns:1!==e.columns?e.columns:null,formspan:1!==e.width?e.width:null}).on("submit",(e=>{e.preventDefault();const t={};this.inputList.forEach(((e,o)=>{"checkbox"==e.attr("type")?t[o]=e.is(":checked"):t[o]=e.val().toString()})),o(t,this)})),this.content=t,this.inputList=new Map}render(e=!1){if(this.created&&!e)return this.element;this.element[0].innerHTML="";const t=this.element.attr("id");for(const o of this.content)for(const n of o.build(t,e))n.appendTo(this.element);for(const e of this.content)for(const t of e.getInputs()){const e=t.attr("name");void 0!==e&&this.inputList.set(e,t)}return this.created=!0,this.element}reset(){this.inputList.forEach((e=>{const t=e.attr("defval");void 0!==t&&("checkbox"==e.attr("type")?e.prop("checked","true"==t):e.val(t))}))}getInputList(...e){if(0==e.length)return this.inputList;const t=new Map;return this.inputList.forEach(((o,n)=>{e.includes(n)&&t.set(n,o)})),t}static placeholder(e=1){return new Form({columns:e,width:e},[Form.spacer(e)]).render()}static section(e,t){let o;e.name||(e.name=Util.ID.make()),e.columns||(e.columns=1),e.width||(e.width=e.columns),e.label&&(o=FormUtils.makeLabel(e.name,e.label));const n=$("<form-section>").toggleClass(e.wrapper,e.wrapper).attr({id:e.name,labeled:void 0!==e.label?"":null,columns:1!==e.columns?e.columns:null,colspan:1!==e.width?e.width:null});return new FormElement(n,void 0,o,t)}static accordion(e,t){let o;e.name||(e.name=Util.ID.make()),e.columns||(e.columns=1),e.width||(e.width=e.columns),e.label&&(o=FormUtils.makeLabel(e.name,e.label));const n=$("<form-accordion>").toggleClass(e.wrapper,e.wrapper).attr({id:e.name,labeled:void 0!==e.label?"":null,columns:1!==e.columns?e.columns:null,colspan:1!==e.width?e.width:null});return new FormElement(n,void 0,o,t,void 0,(t=>{t.accordion({active:e.active,animate:!1,collapsible:!0===e.collapsible,header:"form-header"}),t.find("form-section[aria-hidden=false]").css("display","")}))}static accordionTab(e,t){e.name||(e.name=Util.ID.make()),e.columns||(e.columns=1),e.width||(e.width=e.columns);const o=$("<form-header>").attr("for",e.name).html(e.label||"TITLE_ERROR");e.subheader&&$("<span>").addClass("form-collapse-subheader").append(e.subheader).appendTo(o),e.badge&&$("<span>").addClass("form-collapse-badge").append(e.badge).appendTo(o);const n=$("<form-section>").addClass("collapse-content").attr({id:e.name,labeled:void 0!==e.label?"":null,columns:1!==e.columns?e.columns:null,colspan:1!==e.width?e.width:null});return new FormElement(n,void 0,o,t)}static collapse(e,t,o){let n;e.name||(e.name=Util.ID.make()),e.columns||(e.columns=1),e.width||(e.width=e.columns),e.label&&(n=FormUtils.makeLabel(e.name,e.label));const i=$("<form-collapse>").attr({id:e.name,colspan:e.width||1}),r=$("<h3>").addClass("collapse-header").html(e.title||"Details").appendTo(i);e.badge&&$("<span>").addClass("form-collapse-badge").append(e.badge).appendTo(r);const a=$("<form-section>").addClass("collapse-content").attr({labeled:void 0!==e.label?"":null,columns:1!==e.columns?e.columns:null,colspan:1!==e.width?e.width:null}).appendTo(i);return i.accordion({active:!e.collapsed,animate:!1,collapsible:!0,header:"h3",beforeActivate:()=>{null!=o&&o(r.attr("id"),"true"==r.attr("aria-expanded"))}}),new FormElement(i,void 0,n,t,a)}static input(e,t){let o;e.name||(e.name=Util.ID.make()),e.label&&(o=FormUtils.makeLabel(e.name,e.label));const n=FormUtils.makeInputWrapper(e.label,e.wrapper,e.width),i=$("<input>").attr({type:"text",id:e.name,name:e.name}).addClass("bg-section color-text").prop("disabled",1==e.disabled).appendTo(n);if(void 0!==e.value&&null!==e.value)switch(typeof e.value){case"function":e.value(i);break;case"object":i.val(e.value.text());break;case"boolean":e.value=e.value+"";default:i.val(e.value).attr("defval",e.value)}if(e.title&&i.attr("title",e.title),e.pattern&&i.attr("pattern",e.pattern),e.required&&i.attr("required",""),void 0!==t){let e;i.on("input",(()=>{e&&clearTimeout(e),e=window.setTimeout((()=>{t(i.val().toString(),i)}),Form.inputTimeout)}))}return new FormElement(n,i,o)}static textarea(e,t){let o;e.name||(e.name=Util.ID.make()),e.label&&(o=FormUtils.makeLabel(e.name,e.label));const n=FormUtils.makeInputWrapper(e.label,e.wrapper,e.width),i=$("<textarea>").attr({type:"text",id:e.name,name:e.name}).addClass("bg-section color-text").prop("disabled",1==e.disabled).appendTo(n);if(void 0!==e.value&&null!==e.value)switch(typeof e.value){case"function":e.value(i);break;case"object":i.val(e.value.text());break;case"boolean":e.value=e.value+"";default:i.val(e.value).attr("defval",e.value)}if(e.title&&i.attr("title",e.title),e.pattern&&i.attr("pattern",e.pattern),e.required&&i.attr("required",""),void 0!==t){let e;i.on("input",(()=>{e&&clearTimeout(e),e=window.setTimeout((()=>{t(i.val().toString(),i)}),Form.inputTimeout)}))}return new FormElement(n,i,o)}static copy(e){let t;e.name||(e.name=Util.ID.make()),e.label&&(t=FormUtils.makeLabel(e.name,e.label));const o=FormUtils.makeInputWrapper(e.label,e.wrapper,e.width).addClass("copybox"),n=$("<input>").attr({type:"text",id:e.name,readonly:""}).addClass("bg-section color-text").appendTo(o);if(void 0!==e.value&&null!==e.value)switch(typeof e.value){case"function":e.value(n);break;case"object":n.val(e.value.text());break;case"boolean":e.value=e.value+"";default:n.val(e.value).attr("defval",e.value)}const i=$("<button>").attr({type:"button",id:e.name+"-copy"}).addClass("button btn-neutral border-highlight border-left").html('<i class="far fa-copy"></i>').appendTo(o);let r;return e.title&&(n.attr("title",e.title),i.attr("title",e.title)),$(i).on("click",(()=>{XM.Util.setClipboard(n.val()),window.clearTimeout(r),n.addClass("highlight"),r=window.setTimeout((()=>n.removeClass("highlight")),250)})),new FormElement(o,n,t)}static key(e,t){let o;e.name||(e.name=Util.ID.make()),e.label&&(o=FormUtils.makeLabel(e.name,e.label));const n=FormUtils.makeInputWrapper(e.label,e.wrapper,e.width).addClass("keyinput"),i=$("<input>").attr({type:"text",id:e.name,readonly:""}).addClass("bg-section color-text").appendTo(n);if(void 0!==e.value&&null!==e.value){switch(typeof e.value){case"function":e.value(i);break;case"object":i.val(e.value.text());break;case"boolean":e.value=e.value+"";default:i.val(e.value).attr("defval",e.value)}i.attr("key",i.val()+"")}const r=$("<span>").addClass("keyinput-warning").attr("title","Duplicate Keybinding").appendTo(n);KeybindManager.count(i.val()+"")<=1&&r.addClass("display-none");const a=$("<button>").attr({type:"button",id:e.name+"-key"}).addClass("button btn-neutral border-highlight border-left").html('<i class="far fa-keyboard"></i>').appendTo(n);e.title&&(i.attr("title",e.title),a.attr("title",e.title));let s=!1;return $(a).on("click",(()=>{if(s)return;s=!0;const e=$(`.keyinput input[key="${i.val()}"]`);e.length>2?r.addClass("display-none"):e.parent().find("span.keyinput-warning").addClass("display-none"),i.addClass("input-info").val("Recording"),KeybindManager.record((e=>{if(e.includes("escape"))i.removeClass("input-info").val("").attr("key",""),void 0!==t&&t("",i),s=!1;else{const n=(o=(o=e).join("+").split("+"),(o=[...new Set(o)]).join("+"));i.removeClass("input-info").val(n).attr("key",n);const r=$(`.keyinput input[key="${n}"]`);r.length>1&&r.parent().find("span.keyinput-warning").removeClass("display-none"),void 0!==t&&t(n,i),s=!1}var o}))})),new FormElement(n,i,o)}static file(e,t){let o;e.name||(e.name=Util.ID.make()),e.label&&(o=FormUtils.makeLabel(e.name,e.label));const n=FormUtils.makeInputWrapper(e.label,e.wrapper,e.width).addClass("fileinput"),i=$("<input>").attr({type:"file",accept:e.accept,id:e.name}).addClass("bg-section color-text").prop("disabled",1==e.disabled).appendTo(n);return e.title&&i.attr("title",e.title),void 0!==t&&i.on("change",(()=>{t(i.prop("files"),i)})),new FormElement(n,i,o)}static icon(e,t,o){let n;e.name||(e.name=Util.ID.make()),e.label&&(n=FormUtils.makeLabel(e.name,e.label));const i=FormUtils.makeInputWrapper(e.label,e.wrapper,e.width),r=$("<input>").attr({type:"text",id:e.name,name:e.name}).css("display","none").appendTo(i);if(void 0!==e.value&&null!==e.value)switch(typeof e.value){case"function":e.value(r);break;case"object":r.val(e.value.text());break;case"boolean":e.value=e.value+"";default:r.val(e.value).attr("defval",e.value)}const a=$("<div>").addClass("icon-picker").appendTo(i);for(const e in t)$("<a>").attr("href","#").attr("data-value",e).html(t[e]?"&#x"+t[e]:"&nbsp;").appendTo(a);return a.find("a").on("click",(e=>{e.preventDefault(),a.find("a").removeClass("active");const t=$(e.target);r.val(t.attr("data-value")),t.addClass("active"),o&&o(r.val().toString(),r)})),e.value?a.find("a[data-value='"+e.value+"']").first().trigger("click"):a.find("a").first().trigger("click"),r.on("re621:form:update",(()=>{console.log("updating",r.val()),""==r.val()?a.find("a").first().trigger("click"):a.find("a[data-value='"+r.val()+"']").first().trigger("click")})),new FormElement(i,r,n)}static button(e,t){let o;e.name||(e.name=Util.ID.make()),e.label&&(o=FormUtils.makeLabel(e.name,e.label));const n=FormUtils.makeInputWrapper(e.label,e.wrapper,e.width),i=$("<button>").attr({id:e.name,type:e.type?e.type:"button"}).addClass("button btn-neutral").prop("disabled",1==e.disabled).appendTo(n);if(void 0!==e.value&&null!==e.value)switch(typeof e.value){case"function":e.value(i);break;case"object":i.append(e.value);break;case"number":case"boolean":e.value=e.value+"";default:i.html(e.value).attr("defval",e.value)}return e.title&&i.attr("title",e.title),void 0!==t&&i.on("click",(e=>{e.preventDefault(),t(!0,i)})),new FormElement(n,i,o)}static checkbox(e,t){e.name||(e.name=Util.ID.make());const o=FormUtils.makeInputWrapper(void 0,e.wrapper,e.width).addClass("checkbox-switch").toggleClass("input-disabled",1==e.disabled),n=$("<input>").attr({id:e.name,name:e.name,type:"checkbox"}).addClass("switch").prop("disabled",1==e.disabled).appendTo(o);if(void 0!==e.value&&null!==e.value)switch(typeof e.value){case"function":e.value(n);break;case"object":break;default:n.prop("checked",e.value).attr("defval",e.value+"")}return $("<label>").attr("for",e.name).addClass("switch").appendTo(o),e.label&&$("<label>").attr("for",e.name).html(e.label).appendTo(o),void 0!==t&&n.on("change",(()=>{t(n.is(":checked"),n)})),new FormElement(o,n)}static select(e,t,o){let n;e.name||(e.name=Util.ID.make()),e.label&&(n=FormUtils.makeLabel(e.name,e.label));const i=FormUtils.makeInputWrapper(e.label,e.wrapper,e.width),r=$("<select>").attr({id:e.name,name:e.name}).addClass("button btn-neutral").prop("disabled",1==e.disabled).appendTo(i);if(void 0!==t){"function"==typeof t&&(t=t());for(const e in t)$("<option>").val(e).text(t[e]).appendTo(r)}if(void 0!==e.value&&null!==e.value)switch(typeof e.value){case"function":e.value(r);break;case"object":r.val(e.value.text());break;case"boolean":e.value=e.value+"";default:r.val(e.value).attr("defval",e.value)}return e.title&&r.attr("title",e.title),void 0!==o&&r.on("change",(()=>{o(r.val().toString(),r)})),new FormElement(i,r,n)}static header(e,t){const o=FormUtils.makeInputWrapper(void 0,void 0,t);return $("<h3>").attr("id",Util.ID.make()).addClass("color-text").html(e).appendTo(o),new FormElement(o)}static div(e){let t;e.name||(e.name=Util.ID.make()),e.label&&(t=FormUtils.makeLabel(e.name,e.label));const o=FormUtils.makeInputWrapper(e.label,e.wrapper,e.width).addClass("text-div").attr("id",e.name);if(void 0!==e.value&&null!==e.value)switch(typeof e.value){case"function":e.value(o);break;case"object":o.append(e.value);break;case"number":case"boolean":e.value=e.value+"";default:o.html(e.value)}return new FormElement(o,void 0,t)}static text(e,t=1,o){return Form.div({value:e,width:t,wrapper:o})}static requiresReload(){return Form.text('<div class="text-center text-bold">Requires a page reload</div>',1,"align-middle")}static subheader(e,t,o=1,n,i){return Form.div({value:`<b>${e}</b><br />${t}`,width:o,wrapper:"subheader"+(i?" "+i:""),name:n})}static hr(e){const t=FormUtils.makeInputWrapper(void 0,void 0,e);return $("<hr>").attr("id",Util.ID.make()).addClass("color-text-muted").appendTo(t),new FormElement(t)}static spacer(e,t=!1){const o=FormUtils.makeInputWrapper(void 0,void 0,e);return $("<spacer>").attr("id",Util.ID.make()).toggleClass("unmargin",t).appendTo(o),new FormElement(o)}}Form.inputTimeout=500;class FormUtils{static makeLabel(e,t){return $("<label>").attr("for",e).html(t)}static makeInputWrapper(e,t,o=1){return $("<form-input>").addClass(t?" "+t:"").attr({labeled:void 0!==e?"":null,colspan:1!==o?o:null})}}class FormElement{constructor(e,t,o,n,i,r){this.wrapper=e,this.input=t,this.label=o,this.content=n||[],this.container=i||e,this.postProcessing=r||(()=>{})}getInput(){return this.input}getInputs(){const e=[];this.input&&e.push(this.input);for(const t of this.content)e.push(...t.getInputs());return e}build(e,t=!1){if(t||!this.created){for(const o of this.content)for(const n of o.build(e+"-"+this.wrapper.attr("id"),t))n.appendTo(this.container);switch(void 0!==this.label&&this.label.attr("for",e+"-"+this.label.attr("for")),void 0!==this.input&&this.input.attr("id",e+"-"+this.input.attr("id")),this.wrapper.prop("tagName")){case"FORM-INPUT":this.wrapper.attr("id")&&this.wrapper.attr("id",e+"-"+this.wrapper.attr("id"));for(const t of this.wrapper.find("> label")){const o=$(t);o.attr("for",e+"-"+o.attr("for"))}break;case"FORM-SECTION":case"FORM-ACCORDION":this.wrapper.attr("id",e+"-"+this.wrapper.attr("id"))}this.postProcessing(this.wrapper),this.created=!0}return this.label?[this.label,this.wrapper]:[this.wrapper]}}var w=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class Component{constructor(e={}){this.initialized=!1,this.eventIndex=0,this.Settings={enabled:!0},e.name?this.name=e.name:this.name=this.constructor.name,e.constraint?Array.isArray(e.constraint)||(e.constraint=[e.constraint]):e.constraint=[],this.constraintMatches=0==e.constraint.length||Page.matches(e.constraint),e.waitForDOM||(e.waitForDOM=!1),this.DOMLoadConditions=e.waitForDOM,this.SettingsCache={enabled:!0},this.execPrepare().then((()=>this.bootstrapSettings())).then((()=>{this.constraintMatches&&("string"==typeof e.waitForDOM?PageObserver.watch(e.waitForDOM).then((e=>{e&&this.execCreate()})):e.waitForDOM?$((()=>this.execCreate())):this.execCreate())}))}bootstrapSettings(){return w(this,void 0,void 0,(function*(){for(const[e,t]of Object.entries(this.Settings)){const o=yield XM.Storage.getValue(this.name+"."+e,t);this.SettingsCache[e]=o;const n=this;Object.defineProperty(this.Settings,e,{get:()=>n.SettingsCache[e],set(o){n.SettingsCache[e]=o,console.log(JSON.stringify(o),JSON.stringify(t),JSON.stringify(o)==JSON.stringify(t)),JSON.stringify(o)==JSON.stringify(t)?XM.Storage.deleteValue(n.name+"."+e):XM.Storage.setValue(n.name+"."+e,o)}}),XM.Storage.addListener(this.name+"."+e,((t,o,n,i)=>{i&&(this.SettingsCache[e]=n),this.trigger("settings."+e+(i?".remote":".local"),n)}))}this.on("settings.enabled",(e=>{e?this.load():this.unload()}))}))}load(){return w(this,void 0,void 0,(function*(){this.constraintMatches&&("string"==typeof this.DOMLoadConditions?PageObserver.watch(this.DOMLoadConditions).then((e=>{e&&this.execCreate()})):this.DOMLoadConditions?$((()=>this.execCreate())):this.execCreate(),this.trigger("load"))}))}unload(){return w(this,void 0,void 0,(function*(){yield this.execDestroy(),this.trigger("unload")}))}reload(){return w(this,void 0,void 0,(function*(){yield this.unload(),yield this.load()}))}prepare(){return w(this,void 0,void 0,(function*(){}))}execPrepare(){return w(this,void 0,void 0,(function*(){try{yield this.prepare()}catch(e){}this.trigger("prepare")}))}create(){return w(this,void 0,void 0,(function*(){}))}execCreate(){return w(this,void 0,void 0,(function*(){if(!this.initialized){try{yield this.create()}catch(e){return void ErrorHandler.log(`[${this.name}] fatal crash during initialization`,e)}this.initialized=!0,this.trigger("create")}}))}destroy(){return w(this,void 0,void 0,(function*(){}))}execDestroy(){return w(this,void 0,void 0,(function*(){if(this.initialized){try{yield this.destroy()}catch(e){}this.initialized=!1,this.trigger("destroy")}}))}trigger(e,t){$(document).trigger(`re621.${this.name}.${e}`,t)}on(e,t){return $(document).on(`re621.${this.name}.${e}.${this.eventIndex}`,t),this.eventIndex++}one(e,t){$(document).one(`re621.${this.name}.${e}`,t)}off(e,t){$(document).off(`re621.${this.name}.${e}`+(t?`.${t}`:""))}}var y=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class HeaderCustomizer extends Component{constructor(){super({waitForDOM:"menu.extra"}),this.editingMode=!1,this.Settings={enabled:!0,hotkeyTab1:"1",hotkeyTab2:"2",hotkeyTab3:"3",hotkeyTab4:"4",hotkeyTab5:"5",hotkeyTab6:"6",hotkeyTab7:"7",hotkeyTab8:"8",hotkeyTab9:"9",tabs:[{name:"Profile",href:"/users/%userID%"},{name:"Posts",href:"/posts"},{name:"Comments",href:"/comments?group_by=post"},{name:"Artists",href:"/artists"},{name:"Tags",href:"/tags"},{name:"Blips",href:"/blips"},{name:"Pools",href:"/pools"},{name:"Sets",href:"/post_sets"},{name:"Wiki",href:"/wiki_pages?title=help:home"},{name:"Forum",href:"/forum_topics"},{name:"Discord",href:"/static/discord"},{name:"Help",href:"/help"},{name:"More »",href:"/static/site_map"}],forumUpdateDot:!0}}get isEditing(){return this.editingMode}set isEditing(e){this.editingMode=e,e?(this.$menu.attr("data-editing","true"),this.$menu.sortable("enable"),this.addTabModal.open(),this.updateTabModal.enable()):(this.$menu.attr("data-editing","false"),this.$menu.sortable("disable"),this.addTabModal.close(),this.updateTabModal.close(),this.updateTabModal.disable())}create(){return y(this,void 0,void 0,(function*(){this.hasForumUpdates=$("li#nav-forum").hasClass("forum-updated"),this.$menu=$("menu.main"),this.$oldMenu=$("<div>").css("display","none").appendTo("body"),this.$menu.children().appendTo(this.$oldMenu),this.$menu.addClass("custom"),this.rebuildTabs(),this.toggleForumDot(this.Settings.forumUpdateDot),this.createConfigInterface(),this.$menu.sortable({axis:"x",containment:"parent",helper:"clone",forceHelperSize:!0,opacity:.75,cursor:"grabbing",disabled:!0,update:()=>{this.reloadTabMargins(),this.saveNavbarSettings()}}),this.on("settings.tabs.remote",(()=>{this.isEditing=!1,this.rebuildTabs(),this.updateTabModal.clearTriggers(),this.updateTabModal.registerTrigger({element:$("menu.main li a")})})),this.on("settings.forumUpdateDot.remote",(()=>{this.toggleForumDot(this.Settings.forumUpdateDot)}))}))}destroy(){return y(this,void 0,void 0,(function*(){this.$menu.removeClass("custom").empty(),this.$menu.sortable("destroy"),this.addTabButton.remove(),this.addTabModal.destroy(),this.updateTabModal.destroy(),this.$oldMenu.children().appendTo(this.$menu),this.$oldMenu.remove()}))}createConfigInterface(){this.addTabButton=Util.DOM.addSettingsButton({id:"header-button-customizer",name:'<i class="fas fa-tasks"></i>',title:"Edit Header Tabs",tabClass:"float-left",onClick:()=>{this.isEditing=!this.isEditing}});const e=new Form({name:"header-customizer-new"},[Form.input({label:"Name",name:"name",value:"",required:!0,pattern:"[\\S ]+"}),Form.input({label:"Hover",value:"",name:"title"}),Form.input({label:"Link",value:"",name:"href"}),Form.checkbox({label:"Attach to the right side",value:!1,name:"right"}),Form.button({value:"Submit",type:"submit"}),Form.hr(),Form.div({value:"Available variables:"}),Form.copy({label:"Unique ID",value:"%userID%"}),Form.copy({label:"Username",value:"%username%"}),Form.hr(),Form.div({value:"Drag-and-drop tabs to re-arrange.<br />Click on a tab to edit it."})],((e,t)=>{this.addTab({name:e.name,title:e.title,href:e.href,right:e.right}),t.reset(),this.reloadTabMargins()}));this.addTabModal=new Modal({title:"Add Tab",content:Form.placeholder(),structure:e,position:{my:"right top",at:"right top"}}),this.addTabModal.getElement().on("dialogclose",(()=>{this.isEditing=!1})),this.updateTabForm=new Form({name:"header-customizer-update"},[Form.input({label:"Name",name:"name",value:"",required:!0,pattern:"[\\S ]+"}),Form.input({label:"Hover",value:"",name:"title"}),Form.input({label:"Link",value:"",name:"href"}),Form.checkbox({label:"Attach to the right side",value:!1,name:"right"}),Form.button({value:"Delete",type:"button"},(()=>{this.deleteTab(this.updateTabModal.getActiveTrigger().parent()),this.updateTabModal.close()})),Form.button({value:"Update",type:"submit"})],((e,t)=>{this.updateTab(this.updateTabModal.getActiveTrigger().parent(),{name:e.name,title:e.title,href:e.href,right:e.right}),this.updateTabModal.close(),t.reset(),this.reloadTabMargins()})),this.updateTabModal=new Modal({title:"Update Tab",triggers:[{element:$("menu.main li a")}],content:Form.placeholder(),structure:this.updateTabForm,position:{my:"center top",at:"center top"},triggerMulti:!0,disabled:!0}),this.updateTabModal.getElement().on("dialogopen",(()=>{const e=this.updateTabModal.getActiveTrigger().parent(),t=this.updateTabForm.getInputList();t.get("name").val(e.data("tab.name")),t.get("title").val(e.data("tab.title")),t.get("href").val(e.data("tab.href")),t.get("right").prop("checked",e.data("tab.right"))}))}rebuildTabs(){this.$menu.html("");for(const e of this.Settings.tabs)this.createTabElement(e);this.reloadTabMargins()}toggleForumDot(e){this.$menu.attr("data-forumdot",""+e)}createTabElement(e,t=!1){e=this.parseHeaderTabConfig(e);const o=$("<li>").data({"tab.name":e.name,"tab.title":e.title,"tab.href":e.href,"tab.right":e.right}).attr("align",e.right?"true":void 0).appendTo(this.$menu),n=$("<a>").html(this.processTabVariables(e.name)).appendTo(o);return""!==e.title&&n.attr("title",this.processTabVariables(e.title)),""!==e.href&&n.attr("href",this.processTabVariables(e.href)),"/forum_topics"===e.href&&this.hasForumUpdates?n.addClass("tab-has-updates"):"/users/%userID%"!=e.href&&"/users/home"!=e.href||User.loggedIn||n.attr("href","/session/new").addClass("tab-login").html("Sign In"),t&&this.saveNavbarSettings(),""!==e.href.trim()&&Page.getURL().pathname.includes(this.processTabVariables(e.href).split("?")[0])&&o.addClass("bg-foreground"),{tab:o,link:n}}parseHeaderTabConfig(e){return void 0===e.name&&(e.name="New Tab"),void 0===e.href&&(e.href=""),void 0===e.title&&(e.title=""),void 0===e.right&&(e.right=!1),e}addTab(e){e=this.parseHeaderTabConfig(e);const t=this.createTabElement(e,!0);this.updateTabModal.registerTrigger({element:t.link})}updateTab(e,t){t=this.parseHeaderTabConfig(t),e.data({"tab.name":t.name,"tab.title":t.title,"tab.href":t.href,"tab.right":t.right}).removeAttr("align").attr("align",t.right?"true":void 0),e.find("a").first().html(this.processTabVariables(t.name)).attr("title",this.processTabVariables(t.title)).attr("href",this.processTabVariables(t.href)),this.saveNavbarSettings()}deleteTab(e){e.remove(),this.saveNavbarSettings()}processTabVariables(e){return e.replace(/%userID%/gi,User.userID+"").replace(/%username%/gi,User.username)}saveNavbarSettings(){return y(this,void 0,void 0,(function*(){const e=[];function t(e){if(e)return e}this.$menu.find("li").each((function(o,n){const i=$(n);e.push({name:t(i.data("tab.name")),title:t(i.data("tab.title")),href:t(i.data("tab.href")),right:!!i.data("tab.right")||void 0})})),this.Settings.tabs=e}))}reloadTabMargins(){this.$menu.children("li").removeClass("margined"),this.$menu.find("li[align=true]").first().addClass("margined")}}var x=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class ThemeCustomizer extends Component{create(){return x(this,void 0,void 0,(function*(){const e=Util.DOM.addSettingsButton({id:"header-button-theme",name:'<i class="fas fa-paint-brush"></i>',title:"Change Theme"}),t=new Form({name:"theme-customizer"},[Form.select({label:"Theme",name:"th-main",value:e=>{this.$main=e,e.val(window.localStorage.getItem("theme")||"hexagon")}},{hexagon:"Hexagon",pony:"Pony",bloodlust:"Bloodlust",serpent:"Serpent",hotdog:"Hotdog"},(e=>{Util.LS.setItem("theme",e),$("body").attr("data-th-main",e),this.trigger("switch.theme",e)})),Form.select({label:"Extras",name:"th-extra",value:e=>{this.$extra=e,e.val(window.localStorage.getItem("theme-extra")||"hexagons")}},{none:"None",aurora:"Aurora",autumn:"Autumn",hexagon:"Hexagon",space:"Space",spring:"Spring",stars:"Stars",winter:"Winter"},(e=>{Util.LS.setItem("theme-extra",e),$("body").attr("data-th-extra",e),this.trigger("switch.extras",e)})),Form.select({label:"Post Navbar",name:"th-nav",value:e=>{this.$nav=e,e.val(Util.LS.getItem("theme-nav")||"top")}},{top:"Top",bottom:"Bottom",both:"Both",left:"Sidebar",none:"None"},(e=>{Util.LS.setItem("theme-nav","top"),$("body").attr("data-th-nav",e),this.trigger("switch.navbar",e)}))]);new Modal({title:"Themes",triggers:[{element:e}],content:Form.placeholder(),structure:t,position:{my:"right top",at:"right top"}}),$(window).on("storage",(e=>{let t=e.originalEvent.newValue;switch(e.originalEvent.key){case"theme":t=t||"hexagon",$("body").attr("data-th-main",t),this.$main.val(t);break;case"theme-extra":t=t||"hexagon",$("body").attr("data-th-extra",t),this.$extra.val(t);break;case"theme-nav":t=t||"top",$("body").attr("data-th-nav",t),this.$nav.val(t)}}))}))}}var k=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class DMailHeaderButton extends Component{constructor(){super({waitForDOM:"menu.extra"})}create(){return k(this,void 0,void 0,(function*(){Util.DOM.addSettingsButton({id:"header-button-dmail",name:'<i class="fas fa-envelope"></i>',href:"/dmails",title:"DMail"})}))}}var M=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))};class RE621{constructor(){this.loadOrder=[ThemeCustomizer,HeaderCustomizer,DMailHeaderButton]}run(){return M(this,void 0,void 0,(function*(){console.log("[%cRE621 v.1.0.0%c]","color: maroon","color: black");try{console.log("+ Page Observer"),PageObserver.init(),PageObserver.watch("head").then((()=>{Debug.log("+ HEAD is ready");const e=DOMTools.addStyle('a{cursor:pointer}.float-left{float:left}.float-right{float:right}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.align-middle{align-self:center}.display-none{display:none}.display-none-important{display:none !important}.display-inline{display:inline}.display-block{display:block}.vis-hidden{visibility:hidden}.vis-shown{visibility:visible}.border-left{border-width:0px !important;border-left-width:1px !important}.text-bold{font-weight:bold}.lds-ellipsis{display:inline-block;position:relative;width:80px;height:80px}.lds-ellipsis div{position:absolute;top:33px;width:13px;height:13px;border-radius:50%;background:#fff;animation-timing-function:cubic-bezier(0, 1, 1, 0)}.lds-ellipsis div:nth-child(1){left:8px;animation:lds-ellipsis1 .6s infinite}.lds-ellipsis div:nth-child(2){left:8px;animation:lds-ellipsis2 .6s infinite}.lds-ellipsis div:nth-child(3){left:32px;animation:lds-ellipsis2 .6s infinite}.lds-ellipsis div:nth-child(4){left:56px;animation:lds-ellipsis3 .6s infinite}@keyframes lds-ellipsis1{0%{transform:scale(0)}100%{transform:scale(1)}}@keyframes lds-ellipsis3{0%{transform:scale(1)}100%{transform:scale(0)}}@keyframes lds-ellipsis2{0%{transform:translate(0, 0)}100%{transform:translate(24px, 0)}}header#top nav#nav{display:grid;grid-template-columns:min-content 1fr max-content}header#top nav#nav menu.logo{background:none;margin-top:0}header#top nav#nav menu.main{padding:6px 0}header#top nav#nav menu.extra{background:none;margin-top:0;padding:6px 0 6px .5rem}header#top nav#nav menu.extra li a{cursor:pointer;padding:6px}header#top nav#nav menu.subnav{grid-column:span 3}@media(min-width: 801px){header#top nav#nav menu.main,header#top nav#nav menu.subnav{overflow:hidden;white-space:nowrap}}form.form-section,form-section{display:grid;grid-column-gap:.5rem;grid-row-gap:.5rem}form.form-section[labeled][colspan="2"],form-section[labeled][colspan="2"]{grid-column:span 3}form.form-section[labeled][colspan="3"],form-section[labeled][colspan="3"]{grid-column:span 5}form.form-section:not([labeled]):not([colspan]),form.form-section:not([labeled])[colspan="1"],form-section:not([labeled]):not([colspan]),form-section:not([labeled])[colspan="1"]{grid-column:span 2}form.form-section:not([labeled])[colspan="2"],form-section:not([labeled])[colspan="2"]{grid-column:span 4}form.form-section:not([labeled])[colspan="3"],form-section:not([labeled])[colspan="3"]{grid-column:span 6}form.form-section:not([columns]),form.form-section[columns="1"],form-section:not([columns]),form-section[columns="1"]{grid-template-columns:5rem 10rem}form.form-section[columns="2"],form-section[columns="2"]{grid-template-columns:5rem 10rem 5rem 10rem}form.form-section[columns="3"],form-section[columns="3"]{grid-template-columns:5rem 10rem 5rem 10rem 5rem 10rem}form.form-section:not([formspan]),form.form-section[formspan="1"]{width:15.5rem}form.form-section[formspan="2"]{width:31.5rem}form.form-section[formspan="3"]{width:47.5rem}form.form-section>label,form-section>label{font-weight:500;align-self:center}form.form-section>form-input,form-section>form-input{display:flex;justify-content:space-between;align-items:center}form.form-section>form-input[labeled][colspan="2"],form-section>form-input[labeled][colspan="2"]{grid-column:span 3}form.form-section>form-input[labeled][colspan="3"],form-section>form-input[labeled][colspan="3"]{grid-column:span 5}form.form-section>form-input:not([labeled]):not([colspan]),form.form-section>form-input:not([labeled])[colspan="1"],form-section>form-input:not([labeled]):not([colspan]),form-section>form-input:not([labeled])[colspan="1"]{grid-column:span 2}form.form-section>form-input:not([labeled])[colspan="2"],form-section>form-input:not([labeled])[colspan="2"]{grid-column:span 4}form.form-section>form-input:not([labeled])[colspan="3"],form-section>form-input:not([labeled])[colspan="3"]{grid-column:span 6}form.form-section>form-input>input,form.form-section>form-input>select,form.form-section>form-input>textarea,form-section>form-input>input,form-section>form-input>select,form-section>form-input>textarea{width:100%;height:100%;padding:0 .25rem;border-radius:4px;border:1px solid transparent;border-left-width:5px;min-height:1.25rem;overflow:hidden}form.form-section>form-input>input:required,form.form-section>form-input>select:required,form.form-section>form-input>textarea:required,form-section>form-input>input:required,form-section>form-input>select:required,form-section>form-input>textarea:required{border-left:5px solid gray}form.form-section>form-input>input:invalid,form.form-section>form-input>select:invalid,form.form-section>form-input>textarea:invalid,form-section>form-input>input:invalid,form-section>form-input>select:invalid,form-section>form-input>textarea:invalid{border-left:5px solid orange}form.form-section>form-input>input:valid,form.form-section>form-input>select:valid,form.form-section>form-input>textarea:valid,form-section>form-input>input:valid,form-section>form-input>select:valid,form-section>form-input>textarea:valid{border-left:5px solid transparent}form.form-section>form-input>button.button,form-section>form-input>button.button{width:100%;height:100%;min-height:1.25rem;padding:0 .25rem;border-radius:4px}form.form-section>form-input.copybox,form.form-section>form-input.keyinput,form-section>form-input.copybox,form-section>form-input.keyinput{display:inline-grid;grid-template-columns:80% 20%;overflow:hidden;position:relative}form.form-section>form-input.copybox input[type=text],form.form-section>form-input.keyinput input[type=text],form-section>form-input.copybox input[type=text],form-section>form-input.keyinput input[type=text]{width:unset;border-radius:4px 0 0 4px;text-align:center;outline:0;box-shadow:none;transition:box-shadow .25s linear}form.form-section>form-input.copybox input[type=text].input-info,form.form-section>form-input.keyinput input[type=text].input-info,form-section>form-input.copybox input[type=text].input-info,form-section>form-input.keyinput input[type=text].input-info{color:orange}form.form-section>form-input.copybox input[type=text].highlight,form.form-section>form-input.keyinput input[type=text].highlight,form-section>form-input.copybox input[type=text].highlight,form-section>form-input.keyinput input[type=text].highlight{box-shadow:inset 0px 0px 0px 2px #ffffff60}form.form-section>form-input.copybox span.keyinput-warning,form.form-section>form-input.keyinput span.keyinput-warning,form-section>form-input.copybox span.keyinput-warning,form-section>form-input.keyinput span.keyinput-warning{position:absolute;width:0;right:calc(20% + 1.25rem)}form.form-section>form-input.copybox span.keyinput-warning:before,form.form-section>form-input.keyinput span.keyinput-warning:before,form-section>form-input.copybox span.keyinput-warning:before,form-section>form-input.keyinput span.keyinput-warning:before{content:"\\f12a";font-family:"Font Awesome 5 Free";font-weight:900;color:coral}form.form-section>form-input.copybox button[type=button],form.form-section>form-input.keyinput button[type=button],form-section>form-input.copybox button[type=button],form-section>form-input.keyinput button[type=button]{width:unset;border-radius:0 4px 4px 0;outline:0}form.form-section>form-input.keyinput input[type=text],form-section>form-input.keyinput input[type=text]{text-transform:uppercase;font-family:monospace;font-size:1.3em}form.form-section>form-input.fileinput input[type=file],form-section>form-input.fileinput input[type=file]{width:stretch}form.form-section>form-input div.icon-picker,form-section>form-input div.icon-picker{display:grid;grid-template-columns:repeat(auto-fit, 23px);grid-column-gap:.29rem;grid-row-gap:.3rem;width:100%}form.form-section>form-input div.icon-picker a,form-section>form-input div.icon-picker a{display:inline-flex;justify-content:space-around;padding:.125rem .25rem;outline:0;font-family:"Font Awesome 5 Free";font-weight:900;border:1px dashed #666}form.form-section>form-input div.icon-picker a.active,form-section>form-input div.icon-picker a.active{background:#ffffff30}form.form-section>form-input.checkbox-switch,form-section>form-input.checkbox-switch{justify-content:unset}form.form-section>form-input.checkbox-switch input[type=checkbox],form-section>form-input.checkbox-switch input[type=checkbox]{display:none}form.form-section>form-input.checkbox-switch input[type=checkbox]+label:before,form-section>form-input.checkbox-switch input[type=checkbox]+label:before{content:"\\f0c8";font-family:"Font Awesome 5 Free";display:inline-block;letter-spacing:10px;cursor:pointer}form.form-section>form-input.checkbox-switch input[type=checkbox]:checked+label:before,form-section>form-input.checkbox-switch input[type=checkbox]:checked+label:before{content:"\\f14a"}form.form-section>form-input.checkbox-switch label,form-section>form-input.checkbox-switch label{cursor:pointer;font-weight:500}form.form-section>form-input.radio-switch,form-section>form-input.radio-switch{justify-content:unset}form.form-section>form-input.radio-switch div.radio-element,form-section>form-input.radio-switch div.radio-element{display:inline-flex;margin-right:.25rem;border-radius:4px}form.form-section>form-input.radio-switch div.radio-element:last-child,form-section>form-input.radio-switch div.radio-element:last-child{margin-right:0}form.form-section>form-input.radio-switch div.radio-element input[type=radio],form-section>form-input.radio-switch div.radio-element input[type=radio]{display:none}form.form-section>form-input.radio-switch div.radio-element label,form-section>form-input.radio-switch div.radio-element label{padding:.25rem .5rem;min-width:3rem;text-align:center;cursor:pointer}form.form-section>form-input.text-div,form-section>form-input.text-div{display:block;width:100%;line-height:1.25rem}form.form-section>form-input.text-div div.notice,form-section>form-input.text-div div.notice{font-size:smaller}form.form-section>form-input.text-div div.unmargin,form-section>form-input.text-div div.unmargin{margin:-0.5rem 0}form.form-section>form-input.text-div pre,form-section>form-input.text-div pre{display:inline;background:#ffffff15;padding:0 .25rem;border-radius:.25rem}form.form-section>form-input.text-div.subheader,form-section>form-input.text-div.subheader{padding-left:1.5rem}form.form-section>form-input>spacer,form-section>form-input>spacer{display:block;height:1em}form.form-section>form-input>spacer.unmargin,form-section>form-input>spacer.unmargin{height:0}form.form-section>form-input>hr,form-section>form-input>hr{width:100%;border:0;border-top:1px solid #ffffff33}form.form-section>form-input.input-disabled,form-section>form-input.input-disabled{color:#666 !important}form.form-section>form-input.input-disabled>select,form.form-section>form-input.input-disabled>input,form-section>form-input.input-disabled>select,form-section>form-input.input-disabled>input{color:#666 !important}form.form-section>form-collapse,form-section>form-collapse{display:block;justify-content:space-between;align-items:center;margin:0 -0.75rem 0 -0.75rem !important;width:stretch}form.form-section>form-collapse[labeled][colspan="2"],form-section>form-collapse[labeled][colspan="2"]{grid-column:span 3}form.form-section>form-collapse[labeled][colspan="3"],form-section>form-collapse[labeled][colspan="3"]{grid-column:span 5}form.form-section>form-collapse:not([labeled]):not([colspan]),form.form-section>form-collapse:not([labeled])[colspan="1"],form-section>form-collapse:not([labeled]):not([colspan]),form-section>form-collapse:not([labeled])[colspan="1"]{grid-column:span 2}form.form-section>form-collapse:not([labeled])[colspan="2"],form-section>form-collapse:not([labeled])[colspan="2"]{grid-column:span 4}form.form-section>form-collapse:not([labeled])[colspan="3"],form-section>form-collapse:not([labeled])[colspan="3"]{grid-column:span 6}form.form-section>form-collapse>h3.collapse-header,form-section>form-collapse>h3.collapse-header{border:unset !important;background:#ffffff08 !important;color:unset !important;font-weight:unset !important;outline:0;padding:.25rem .5rem;cursor:pointer}form.form-section>form-collapse>h3.collapse-header span.form-collapse-badge,form-section>form-collapse>h3.collapse-header span.form-collapse-badge{float:right;width:2rem;padding:0 .5rem;margin-right:.25rem;border-radius:.5rem;background:#00000030;box-shadow:inset 0 0 5px 0px #00000050;font-weight:bold;text-align:center}form.form-section>form-collapse>form-section.collapse-content,form-section>form-collapse>form-section.collapse-content{height:unset !important;background:#ffffff05;color:unset;border:0;padding:.25rem .75rem}form-accordion{display:block;justify-content:space-between;align-items:center;margin:0 -0.75rem 0 -0.75rem !important;width:stretch}form-accordion[labeled][colspan="2"]{grid-column:span 3}form-accordion[labeled][colspan="3"]{grid-column:span 5}form-accordion:not([labeled]):not([colspan]),form-accordion:not([labeled])[colspan="1"]{grid-column:span 2}form-accordion:not([labeled])[colspan="2"]{grid-column:span 4}form-accordion:not([labeled])[colspan="3"]{grid-column:span 6}form-accordion>form-header{display:block;border:unset !important;border-bottom:1px solid #ffffff11 !important;background:#ffffff08 !important;color:unset !important;font-weight:unset !important;font-size:1.16667em;outline:0;padding:.25rem .5rem;cursor:pointer}form-accordion>form-header span.form-collapse-subheader{float:right;font-size:70%;padding:.25rem}form-accordion>form-header span.form-collapse-badge{float:right;width:2rem;padding:0 .5rem;margin-right:.25rem;border-radius:.5rem;background:#00000030;box-shadow:inset 0 0 5px 0px #00000050;font-weight:bold;text-align:center}form-accordion>form-section.collapse-content{height:unset !important;background:#ffffff05;border-bottom:1px solid #ffffff11 !important;color:unset;border:0;padding:1rem .75rem}div#modal-container{position:fixed;left:1rem;right:1rem;top:30px;bottom:30px;z-index:500;pointer-events:none;box-sizing:border-box}div#modal-container div.ui-dialog{position:absolute !important;pointer-events:auto;border-radius:6px;min-width:max-content;max-width:fit-content;box-shadow:0 5px 15px -5px #000;outline:0;background-image:url("/packs/media/src/styles/images/extras/hex-6029a8f11b7ec7b1f0638e3d8f18b6cb.png");background-position:left 2rem;background-repeat:repeat-x}div#modal-container div.ui-dialog.modal-fixed{position:fixed !important}div#modal-container div.ui-dialog.modal-reserve-height div.ui-dialog-content{height:80vh !important}div#modal-container div.ui-dialog div.ui-dialog-titlebar{position:relative;padding:0;border:unset !important;border-radius:6px 6px 0 0;color:inherit !important;background-color:#00000066;cursor:grab;height:2rem}div#modal-container div.ui-dialog div.ui-dialog-titlebar span.ui-dialog-title{float:left;padding:.4em 1em;margin:.1em 0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}div#modal-container div.ui-dialog div.ui-dialog-titlebar button.ui-dialog-titlebar-close{position:absolute;height:100%;margin:0;right:0;top:0;padding:0;width:3em;outline:0;border:0;border-left:1px solid #66666666;border-width:0 0 0 1px !important;background:unset;box-shadow:unset}div#modal-container div.ui-dialog div.ui-dialog-titlebar button.ui-dialog-titlebar-close:hover,div#modal-container div.ui-dialog div.ui-dialog-titlebar button.ui-dialog-titlebar-close:active{background:#ffffff10}div#modal-container div.ui-dialog div.ui-dialog-titlebar button.ui-dialog-titlebar-close:hover span.ui-icon,div#modal-container div.ui-dialog div.ui-dialog-titlebar button.ui-dialog-titlebar-close:active span.ui-icon{background-image:url(/packs/media/images/ui-icons_ffffff_256x240-bf27228a.png);background-position:-96px -128px}div#modal-container div.ui-dialog.ui-draggable-dragging div.ui-dialog-titlebar{cursor:grabbing}div#modal-container div.ui-dialog div.ui-dialog-content{position:relative;padding:1em 1em;min-width:fit-content;height:90% !important;overflow:hidden scroll;padding-left:.75rem;padding-right:.5rem;border:unset !important;background-color:unset !important;color:unset !important}div#modal-container div.ui-dialog div.ui-dialog-content .ui-tabs{margin-top:-1em}div#modal-container div.ui-dialog div.ui-dialog-content::-webkit-scrollbar{width:6px;height:6px}div#modal-container div.ui-dialog div.ui-dialog-content::-webkit-scrollbar-thumb{height:6px;background-color:#ffffff55}div#modal-container div.ui-dialog div.ui-dialog-content::-webkit-scrollbar-button{width:0;height:0;display:none}div#modal-container div.ui-dialog div.ui-dialog-content::-webkit-scrollbar-track,div#modal-container div.ui-dialog div.ui-dialog-content::-webkit-scrollbar-corner{background-color:transparent}div#modal-container div.ui-dialog div.ui-dialog-content{scrollbar-width:thin;scrollbar-color:#ffffff55 transparent}div.error-container{padding:.5rem .75rem}div.error-container textarea.error-message{width:100%;height:100%}header#top nav#nav menu.main.ui-sortable{padding:0}@media(min-width: 801px){header#top nav#nav menu.main.ui-sortable{display:inline-flex}}header#top nav#nav menu.main.ui-sortable li{padding:6px 0;margin-right:1px;display:inline-block;height:auto !important}header#top nav#nav menu.main.ui-sortable li>a{outline:0}header#top nav#nav menu.main.ui-sortable[data-editing=true] li{background-color:#ffffff40}header#top nav#nav menu.main.ui-sortable[data-editing=true] li[align=true]{background-color:#ffaf9940}header#top nav#nav menu.main.ui-sortable:not([data-editing=true]) li:not([align=true]){order:10}header#top nav#nav menu.main.ui-sortable:not([data-editing=true]) li[align=true]{order:20}header#top nav#nav menu.main.ui-sortable:not([data-editing=true]) li[align=true].margined{margin-left:auto}header#top nav#nav menu.main.ui-sortable[data-forumdot=true] li>a.tab-has-updates::after{content:"\\f111";font-family:"Font Awesome 5 Free";font-weight:900;font-size:.5em;color:red;position:absolute;top:-3px}header#top nav#nav menu.main.ui-sortable a.tab-login{font-weight:700;color:red}');$((()=>{e.appendTo("head")}))})),PageObserver.watch("body").then((()=>{Debug.log("+ BODY is ready"),DOMTools.setupDialogContainer(),User.init()})),PageObserver.watch("menu.main").then((()=>{Debug.log("+ MENU is ready"),DOMTools.patchHeader()}))}catch(e){return void ErrorHandler.log("An error ocurred during script initialization",e)}for(const e of this.loadOrder)RE621.modules[e.constructor.name]=new e}))}}RE621.modules={},(new RE621).run()})();
//# sourceMappingURL=script.user.js.map